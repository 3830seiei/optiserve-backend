graph TD
    A[レポート選択登録リクエスト] --> B[医療機関アクセス権限チェック]
    B --> C[医療機関存在チェック]
    C --> D[機器分類ID存在チェック]
    D --> E[既存選択情報削除]
    E --> F[新選択情報登録（rank順）]
    F --> G[コミット]
    G --> H[分類名取得]
    H --> I[登録完了レスポンス]
    
    B -->|権限なし| J[403 Forbidden]
    C -->|医療機関なし| K[404 Not Found]
    D -->|分類IDなし| L[400 Bad Request]
    F -->|DBエラー| M[ロールバック → 500 Internal Server Error]