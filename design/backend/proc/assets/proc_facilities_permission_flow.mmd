graph TD
    A[APIリクエスト受信] --> B[X-User-Idから権限確認]
    B --> C{システム管理者？}
    C -->|Yes| D[全医療機関データアクセス許可]
    C -->|No| E{医療機関ユーザー？}
    E -->|Yes| F[自医療機関データのみアクセス許可]
    E -->|No| G[403 Forbidden]
    F --> H[medical_idでフィルタリング]
    D --> I[処理実行]
    H --> I