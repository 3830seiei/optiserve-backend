graph TD
    A[分析対象更新リクエスト] --> B[機器台帳存在チェック]
    B --> C[デフォルト値との比較]
    C --> D{デフォルト値と同一？}
    D -->|Yes| E[400 Bad Request]
    D -->|No| F[既存上書き設定チェック]
    F --> G{既存設定あり？}
    G -->|Yes| H[既存設定更新]
    G -->|No| I[新規設定作成]
    H --> J[履歴追加]
    I --> J
    J --> K[DB保存]
    K --> L[更新完了レスポンス]
    
    B -->|機器なし| M[404 Not Found]
    K -->|DBエラー| N[ロールバック → 500 Internal Server Error]