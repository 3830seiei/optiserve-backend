#- metadata -----------------------------------------------
metadata:
  description: カラム名称辞書
  author: H.Miyazawa
  comment: テーブル定義書のカラム情報をまとめたもの
  history:
  - version: 1.0.0
    date: '2025-08-13'
    author: H.Miyazawa
    comment: この時点でのpg_optigate から集めて新規作成
#- id_columns info ----------------------------------------
#  キーになるID情報のみ整理 (primary_key: true)
#  派生形のID情報は除外(user_id に対する、upload_user_id など)
#  キーのカラムは、serialとなるが、参照する側ではinteger登録となる。
id_columns:
  - name: classification_id
    description: 機器分類ID
    data_type: serial
    comment: '機器分類の一意識別子'

  - name: entity_relation_id
    description: 連携する組織ID
    data_type: integer
    comment: '連携する組織のID。entity_typeに応じて医療機関ID、ディーラーID、メーカーIDが入る。管理者時は0がセットされる。'

  - name: ledger_id
    description: 機器台帳ID
    data_type: serial
    comment: '自動採番される台帳レコードの一意識別子'/pg_optigate.medical_equipment_ledgerの値を参照する'

  - name: medical_id
    description: 医療機関ID
    data_type: integer
    comment: '医療機関を特定する為のID'/医療機関別の分類の場合は設定される。NULLの場合は公開用の分類。'/オンプレミス側PostgreSQL tblhpmelist.hpcodeから取得される医療機関識別子'

  - name: publication_id
    description: レポート公開ID
    data_type: serial
    comment: 'レポート公開の一意識別子'

  - name: uploadlog_id
    description: アップロードログID
    data_type: serial
    comment: 'アップロードログの一意識別子'

  - name: user_id
    description: ユーザーID
    data_type: integer
    comment: |
      entity_typeに応じてユニークな値をシステムにて定義。
      システム : 900001 - 999999
      医療機関 : 100001 - 199999
      ディーラー : 200001 - 299999
      メーカー : 300001 - 399999

#- columns info -------------------------------------------
columns:
  - name: address_city
    description: 医療機関の市区町村
    data_type: text
    comment: '医療機関の市区町村（オプション）'

  - name: address_line1
    description: 医療機関の住所1
    data_type: text
    comment: '医療機関の町名以降・番地（オプション）'

  - name: address_line2
    description: 医療機関の住所2
    data_type: text
    comment: '医療機関の建物名等（オプション）'

  - name: address_postal_code
    description: 医療機関の郵便番号
    data_type: text
    comment: '医療機関の郵便番号（オプション）'

  - name: address_prefecture
    description: 医療機関の都道府県
    data_type: text
    comment: '医療機関の都道府県（オプション）'

  - name: analiris_classification_level
    description: 分析レポートの分類レベル
    data_type: integer
    comment: '分析レポートで使用する機器分類のレベル。1: 大分類、2: 中分類、3: 小分類。'

  - name: classification_level
    description: レベル（分類の階層）
    data_type: integer
    comment: '分類の階層を示す。1 : 大分類、 2 : 中分類、3 : 小分類。'

  - name: classification_name
    description: 機器分類名
    data_type: text
    comment: '機器分類の名前。'

  - name: count_reportout_classification
    description: レポート公開の分類数
    data_type: integer
    comment: '医療機関向けレポートに、出力させる機器分類数。'

  - name: default
    description: デフォルト値
    data_type: boolean
    comment: 'カラムのデフォルト値'

  - name: download_datetime
    description: システム側でのダウンロード日時/ユーザーのダウンロード日時
    data_type: timestamp
    comment: 'システム側でのダウンロードが行われた日時。ダウンロードが行われていない場合はNULL。'/ユーザーがファイルのダウンロードを行った日時。ダウンロードが行われていない場合はNULL。最初にダウンロードした日時のみ登録される。'

  - name: download_user_id
    description: ダウンロードを行ったユーザーID
    data_type: integer
    comment: 'ダウンロードを行ったユーザーのID。ユーザーマスタのuser_idと紐づく。最初にダウンロードしたユーザーのみ登録される。'

  - name: e_mail
    description: メールアドレス
    data_type: text
    comment: 'ユーザーのメールアドレス(ログインIDとしても使用)'

  - name: entity_address_city
    description: 組織の市区町村
    data_type: text
    comment: '組織の市区町村（オプション）'

  - name: entity_address_line1
    description: 組織の住所1
    data_type: text
    comment: '組織の町名以降・番地（オプション）'

  - name: entity_address_line2
    description: 組織の住所2
    data_type: text
    comment: '組織の建物名等（オプション）'

  - name: entity_address_postal_code
    description: 組織の郵便番号
    data_type: text
    comment: '組織の郵便番号（オプション）'

  - name: entity_address_prefecture
    description: 組織の都道府県
    data_type: text
    comment: '組織の都道府県（オプション）'

  - name: entity_name
    description: 組織名
    data_type: text
    comment: '表示用に利用する組織名称'

  - name: entity_phone_number
    description: 組織の電話番号
    data_type: text
    comment: '組織の電話番号（オプション）'

  - name: entity_type
    description: 組織の種別
    data_type: integer
    comment: '1: 医療機関, 2: ディーラー, 3: メーカー, 9:管理者権限'

  - name: file_name
    description: アップロードされたファイル名/公開したファイル名
    data_type: text
    comment: 'アップロードされたファイルの名前。'/公開したファイルの名前。'

  - name: file_type
    description: アップロードされたファイルの種類/公開したファイルの種類
    data_type: integer
    comment: 'アップロードされたファイルの種類。1: 医療機器台帳, 2: 貸出履歴, 3: 故障履歴。'/公開したファイルの種類。1: 分析レポート, 2: 故障リスト, 3: 未実績リスト。'

  - name: inactive_reason_code
    description: 無効化理由コード
    data_type: integer
    comment: 'ユーザーが無効化された理由コード（1:組織退会, 2:組織の担当者変更, 3:処理ミス, 99:その他）'

  - name: inactive_reason_note
    description: 無効化理由メモ
    data_type: text
    comment: 'ユーザー無効化の理由メモ（任意）'

  - name: is_included
    description: 分析対象に含めるか
    data_type: boolean
    comment: 'true: 分析対象に含める, false: 分析対象外'

  - name: maker_name
    description: メーカー名
    data_type: text
    comment: 'オンプレミス側PostgreSQL tblhpmelist.makernameのMAX値から取得されるメーカー名'

  - name: medical_name
    description: 医療機関名
    data_type: text
    comment: '医療機関の名称。'

  - name: mobile_number
    description: 携帯電話番号
    data_type: text
    comment: 'ユーザーの携帯電話番号（SMSによる二段階認証で利用）'

  - name: model_number
    description: メーカー型番
    data_type: text
    comment: 'オンプレミス側PostgreSQL tblhpmelist.modelnumberから取得される機器の型番'

  - name: note
    description: 備考（設定理由など）
    data_type: json
    comment: 'user_id, timestamp, note の配列を格納するJSON形式'

  - name: notification_email_list
    description: 通知メールアドレス
    data_type: json
    comment: 'ユーザーアカウントのメールアドレスは必須。それ以外にレポート配布の通知等の情報を受け取るメールアドレスをJSON形式で格納します。複数のメールアドレスを登録することができます。'

  - name: override_classification_id
    description: 上書き用器機分類ID
    data_type: integer
    comment: '医療機関独自の分類を適用する場合にセット'

  - name: publication_classification_id
    description: 公開用の機器分類ID
    data_type: integer
    comment: '公開用の機器分類ID。医療機関別の分類の場合は基本的に設定されるが分類できないものはNULL。公開用の機器分類の場合はNULL。'

  - name: parent_classification_id
    description: 親となる機器分類ID
    data_type: integer
    comment: '親となる機器分類のID。NULLの場合は最上位の分類。'

  - name: password
    description: ユーザーパスワード
    data_type: text
    comment: 'ユーザーのパスワード（ハッシュ化して保存）'

  - name: phone_number
    description: 電話番号/医療機関の電話番号
    data_type: text
    comment: 'ユーザーの電話番号（オプション）'/医療機関の電話番号（オプション）'

  - name: product_name
    description: 機器製品名
    data_type: text
    comment: 'オンプレミス側PostgreSQL tblhpmelist.productnameのMAX値から取得される製品名'

  - name: publication_ym
    description: レポート公開年月
    data_type: text
    comment: 'レポートが公開された年月。'

  - name: rank
    description: 機器分類の表示順序
    data_type: integer
    comment: 'レポートの機器分類の表示順序を示す。小さいほど上位に表示される。'

  - name: stock_quantity
    description: 台帳保有台数
    data_type: integer
    comment: 'オンプレミス側PostgreSQL tblhpmelistでCOUNT(*)により集計された保有台数'

  - name: upload_datetime
    description: アップロード日時/サイトへの更新日時
    data_type: timestamp
    comment: 'アップロードが行われた日時'/サイトへの更新を行った日時'

  - name: upload_user_id
    description: アップロードを行ったユーザーID
    data_type: integer
    comment: 'アップロードを行ったユーザーのID。ユーザーマスタのuser_idと紐づく。'

  - name: user_name
    description: ユーザー名
    data_type: text
    comment: 'ユーザーの表示名'

  - name: user_status
    description: ユーザーステータス
    data_type: integer
    comment: '0: temporary, 1: active, 9: inactive'

#- 全テーブル共通の監査系カラム ----------------------------
common_audit_columns:
  - name: reg_user_id
    description: 登録ユーザーID
    data_type: integer
    primary_key: false
    nullable: false
    comment: 'このレコードの登録を行ったユーザーのID。'
    references:
      table: mst_user
      column: user_id
      enforced: false  # DB制約無し
      on_delete: restrict  # restrict, cascade, set null, no action
      on_update: restrict

  - name: regdate
    description: データ作成日
    data_type: timestamp
    primary_key: false
    nullable: false
    comment: 'レコードの作成日時'

  - name: update_user_id
    description: 更新ユーザーID
    data_type: integer
    primary_key: false
    nullable: false
    comment: 'このレコードの更新を行ったユーザーのID。'
    references:
      table: mst_user
      column: user_id
      enforced: false  # DB制約無し
      on_delete: restrict  # restrict, cascade, set null, no action
      on_update: restrict

  - name: lastupdate
    description: 最終更新日
    data_type: timestamp
    primary_key: false
    nullable: false
    comment: 'レコードの最終更新日時'
