((.venv) ) smds@aoi-ph-017:~/projects/optiserve-backend/data$ pytest tests/ -v -s
================================================== test session starts ==================================================
platform linux -- Python 3.12.11, pytest-8.4.1, pluggy-1.6.0 -- /home/smds/projects/optiserve-backend/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/smds/projects/optiserve-backend/data
plugins: anyio-4.9.0
collected 0 items

================================================= no tests ran in 0.00s =================================================
ERROR: file or directory not found: tests/

((.venv) ) smds@aoi-ph-017:~/projects/optiserve-backend/data$ cd ..
((.venv) ) smds@aoi-ph-017:~/projects/optiserve-backend$ pytest tests/ -v -s
================================================== test session starts ==================================================
platform linux -- Python 3.12.11, pytest-8.4.1, pluggy-1.6.0 -- /home/smds/projects/optiserve-backend/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/smds/projects/optiserve-backend
plugins: anyio-4.9.0
collecting ... ğŸ” ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–‹å§‹: ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆé¸æŠãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...
ğŸ§¹ DB ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—: ãƒ¬ãƒãƒ¼ãƒˆé¸æŠãƒ‡ãƒ¼ã‚¿0ä»¶ã‚’å‰Šé™¤
âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†
collected 89 items

tests/test_01_facilities_api.py::test_create_facility --------------------------------------------------
ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰: {'medical_name': 'pytestç—…é™¢_mruem5', 'address_postal_code': '530-0001', 'address_prefecture': 'å¤§ é˜ªåºœ', 'address_city': 'å¤§é˜ªå¸‚åŒ—åŒº', 'address_line1': 'ãƒ†ã‚¹ãƒˆåŒº2-2-2', 'phone_number': '07-6192-2845'}
ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {'medical_name': 'pytestç—…é™¢_mruem5', 'address_postal_code': '530-0001', 'address_prefecture': 'å¤§é˜ªåºœ', 'address_city': 'å¤§é˜ªå¸‚åŒ—åŒº', 'address_line1': 'ãƒ†ã‚¹ãƒˆåŒº2-2-2', 'address_line2': None, 'phone_number': '07-6192-2845', 'medical_id': 28, 'regdate': '2025-08-28T18:25:00.554273', 'lastupdate': '2025-08-28T18:25:00.554273'}
PASSED
tests/test_01_facilities_api.py::test_create_facility_minimum_fields PASSED
tests/test_01_facilities_api.py::test_get_facilities PASSED
tests/test_01_facilities_api.py::test_get_facilities_with_pagination PASSED
tests/test_01_facilities_api.py::test_get_facility PASSED
tests/test_01_facilities_api.py::test_get_facility_not_found PASSED
tests/test_01_facilities_api.py::test_update_facility --------------------------------------------------
ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰: {'medical_name': 'pytestç—…é™¢_a3td0y_æ›´æ–°', 'address_postal_code': '231-0001', 'address_prefecture': 'ç¥å¥ˆå·çœŒ', 'address_city': 'æ¨ªæµœå¸‚ä¸­åŒº', 'address_line1': 'ãƒ†ã‚¹ãƒˆåŒº3-3-3', 'phone_number': '045-1234-5678'}
ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {'medical_name': 'pytestç—…é™¢_a3td0y_æ›´æ–°', 'address_postal_code': '231-0001', 'address_prefecture': 'ç¥å¥ˆå·çœŒ', 'address_city': 'æ¨ªæµœå¸‚ä¸­åŒº', 'address_line1': 'ãƒ†ã‚¹ãƒˆåŒº3-3-3', 'address_line2': None, 'phone_number': '045-1234-5678', 'medical_id': 30, 'regdate': '2025-08-28T18:25:00.622066', 'lastupdate': '2025-08-28T18:25:00.685661'}
PASSED
tests/test_01_facilities_api.py::test_update_facility_not_found PASSED
tests/test_01_facilities_api.py::test_create_facility_invalid_data PASSED
tests/test_02_user_entity_links_api.py::test_create_user_entity_link
ğŸš€ ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–‹å§‹...
ğŸ” ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–‹å§‹: entity_relation_id=6ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...
API ãƒ¬ã‚¹ãƒãƒ³ã‚¹: status_code=200
å–å¾—ã—ãŸé€£æºãƒ‡ãƒ¼ã‚¿æ•°: 25
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=1
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=4
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=5
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=8
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=9
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=7
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=11
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=12
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=10
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=15
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=13
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=14
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=18
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=16
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=17
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=6
å‰Šé™¤å¯¾è±¡ç™ºè¦‹: entity_type=1, entity_relation_id=6
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=21
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=19
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=20
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=22
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=24
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=23
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=25
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=27
ãƒã‚§ãƒƒã‚¯ä¸­: entity_relation_id=26
âœ¨ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¯¾è±¡ãªã—: entity_relation_id=6ã®ãƒ‡ãƒ¼ã‚¿ã¯å­˜åœ¨ã—ã¾ã›ã‚“
âœ… ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†

FAILED
tests/test_02_user_entity_links_api.py::test_create_invalid_entity_type âœ… ç„¡åŠ¹ãªçµ„ç¹”ç¨®åˆ¥ã‚¨ãƒ©ãƒ¼: çµ„ç¹”ç¨®åˆ¥ï¼ˆentity_typeï¼‰ ã¯1ã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼ˆåŒ»ç™‚æ©Ÿé–¢ã‚¿ã‚¤ãƒ—ï¼‰
PASSED
tests/test_02_user_entity_links_api.py::test_create_invalid_entity_relation_id âœ… å­˜åœ¨ã—ãªã„åŒ»ç™‚æ©Ÿé–¢IDã‚¨ãƒ©ãƒ¼: åŒ»ç™‚æ©Ÿé–¢ID ï¼ˆentity_relation_idï¼‰ 99999 ã¯å­˜åœ¨ã—ã¾ã›ã‚“
PASSED
tests/test_02_user_entity_links_api.py::test_create_invalid_classification_level âœ… ç„¡åŠ¹ãªåˆ†æãƒ¬ãƒ™ãƒ«ã‚¨ãƒ©ãƒ¼: {'detail': [{'type': 'value_error', 'loc': ['body', 'analiris_classification_level'], 'msg': 'Value error, åˆ†æãƒ¬ãƒãƒ¼ãƒˆåˆ†é¡ãƒ¬ãƒ™ãƒ«ï¼ˆanaliris_classification_levelï¼‰ã¯1-3ã®å€¤ã®ã¿æœ‰åŠ¹ã§ã™', 'input': 4, 'ctx': {'error': {}}}]}
PASSED
tests/test_02_user_entity_links_api.py::test_create_missing_required_fields âœ… å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸è¶³ã‚¨ãƒ©ãƒ¼ï¼ˆentity_nameï¼‰
PASSED
tests/test_02_user_entity_links_api.py::test_read_user_entity_links å–å¾—ã—ãŸé€£æºæƒ…å ±: [{'entity_type': 1, 'entity_relation_id': 1, 'entity_name': 'æ±äº¬åŒ»ç§‘å¤§å­¦', 'notification_email_list': '["info@juntendo.ac.jp"]', 'count_reportout_classification': 5, 'analiris_classification_level': 1, 'entity_address_postal_code': '160-8402', 'entity_address_prefecture': 'æ±äº¬éƒ½', 'entity_address_city': 'æ–°å®¿åŒº', 'entity_address_line1': 'æ–°å®¿6-1-1', 'entity_address_line2': None, 'entity_phone_number': '03-3351-6141', 'regdate': '2025-08-13T10:30:00', 'lastupdate': '2025-08-13T10:30:00'}, {'entity_type': 1, 'entity_relation_id': 4, 'entity_name': 'æ„›çŸ¥åŒ»ç§‘å¤§å­¦', 'notification_email_list': '["info@aichi-med-u.ac.jp", "admin@aichi-med-u.ac.jp"]', 'count_reportout_classification': 5, 'analiris_classification_level': 1, 'entity_address_postal_code': '480-1195', 'entity_address_prefecture': 'æ„›çŸ¥çœŒ', 'entity_address_city': 'é•·ä¹…æ‰‹å¸‚', 'entity_address_line1': 'å²©ä½œé›åˆï¼‘ç•ªåœ°ï¼‘', 'entity_address_line2': None, 'entity_phone_number': '0561-62-3311', 'regdate': '2025-08-13T10:30:00', 'lastupdate': '2025-08-13T10:30:00'}, {'entity_type': 1, 'entity_relation_id': 5, 'entity_name': 'é †å¤©å ‚åŒ»é™¢', 'notification_email_list': '["info@tokyo-med.ac.jp"]', 'count_reportout_classification': 5, 'analiris_classification_level': 1, 'entity_address_postal_code': '113-8431', 'entity_address_prefecture': 'æ±äº¬éƒ½', 'entity_address_city': 'æ–‡äº¬åŒº', 'entity_address_line1': 'æœ¬éƒ·3-1-3', 'entity_address_line2': None, 'entity_phone_number': '03-3813-3111', 'regdate': '2025-08-13T10:30:00', 'lastupdate': '2025-08-13T10:30:00'}, {'entity_type': 1, 'entity_relation_id': 8, 'entity_name': 'pytesté€£æºçµ„ç¹”_031jy0', 'notification_email_list': '["pytest_1nbfn0@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-25T14:47:28.869958', 'lastupdate': '2025-08-25T14:47:28.869958'}, {'entity_type': 1, 'entity_relation_id': 9, 'entity_name': 'æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_2vbdik', 'notification_email_list': '["pytest_9vpcpy@example.com"]', 'count_reportout_classification': 3, 'analiris_classification_level': 3, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-25T14:47:28.883818', 'lastupdate': '2025-08-25T14:47:28.887940'}, {'entity_type': 1, 'entity_relation_id': 7, 'entity_name': 'pytesté€£æºçµ„ç¹”_ac4x67', 'notification_email_list': '["pytest_ld4egf@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-25T14:47:28.896230', 'lastupdate': '2025-08-25T14:47:28.896230'}, {'entity_type': 1, 'entity_relation_id': 11, 'entity_name': 'pytesté€£æºçµ„ç¹”_a0ksrf', 'notification_email_list': '["pytest_iopuzx@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-26T17:13:07.921630', 'lastupdate': '2025-08-26T17:13:07.921630'}, {'entity_type': 1, 'entity_relation_id': 12, 'entity_name': 'æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_m8027a', 'notification_email_list': '["pytest_u7zfzw@example.com"]', 'count_reportout_classification': 3, 'analiris_classification_level': 3, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-26T17:13:07.935949', 'lastupdate': '2025-08-26T17:13:07.940366'}, {'entity_type': 1, 'entity_relation_id': 10, 'entity_name': 'pytesté€£æºçµ„ç¹”_xd2m3s', 'notification_email_list': '["pytest_0sj97x@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-26T17:13:07.948816', 'lastupdate': '2025-08-26T17:13:07.948816'}, {'entity_type': 1, 'entity_relation_id': 15, 'entity_name': 'pytesté€£æºçµ„ç¹”_ub0i4z', 'notification_email_list': '["pytest_oj63xq@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-27T14:43:14.267228', 'lastupdate': '2025-08-27T14:43:14.267228'}, {'entity_type': 1, 'entity_relation_id': 13, 'entity_name': 'æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_nr9ba3', 'notification_email_list': '["pytest_2qevzt@example.com"]', 'count_reportout_classification': 3, 'analiris_classification_level': 3, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-27T14:43:14.292606', 'lastupdate': '2025-08-27T14:43:14.298908'}, {'entity_type': 1, 'entity_relation_id': 14, 'entity_name': 'pytesté€£æºçµ„ç¹”_e2a0yj', 'notification_email_list': '["pytest_bz3olt@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-27T14:43:14.309094', 'lastupdate': '2025-08-27T14:43:14.309094'}, {'entity_type': 1, 'entity_relation_id': 18, 'entity_name': 'pytesté€£æºçµ„ç¹”_r70kbk', 'notification_email_list': '["pytest_oqr8xy@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-27T15:38:40.354101', 'lastupdate': '2025-08-27T15:38:40.354101'}, {'entity_type': 1, 'entity_relation_id': 16, 'entity_name': 'æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_2owqts', 'notification_email_list': '["pytest_ks0snj@example.com"]', 'count_reportout_classification': 3, 'analiris_classification_level': 3, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-27T15:38:40.369497', 'lastupdate': '2025-08-27T15:38:40.374831'}, {'entity_type': 1, 'entity_relation_id': 17, 'entity_name': 'pytesté€£æºçµ„ç¹”_ax2n31', 'notification_email_list': '["pytest_7f30ik@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-27T15:38:40.383836', 'lastupdate': '2025-08-27T15:38:40.383836'}, {'entity_type': 1, 'entity_relation_id': 6, 'entity_name': 'pytest é€£æºçµ„ç¹”_66spyq', 'notification_email_list': '["pytest_66h5gc@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 1, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T17:14:00.260581', 'lastupdate': '2025-08-28T17:14:00.260581'}, {'entity_type': 1, 'entity_relation_id': 21, 'entity_name': 'pytesté€£æºçµ„ç¹”_3ou2j9', 'notification_email_list': '["pytest_tdkpol@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T17:14:00.289370', 'lastupdate': '2025-08-28T17:14:00.289370'}, {'entity_type': 1, 'entity_relation_id': 19, 'entity_name': 'æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_jkukq2', 'notification_email_list': '["pytest_jqqg5k@example.com"]', 'count_reportout_classification': 3, 'analiris_classification_level': 3, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T17:14:00.303225', 'lastupdate': '2025-08-28T17:14:00.306626'}, {'entity_type': 1, 'entity_relation_id': 20, 'entity_name': 'pytesté€£æºçµ„ç¹”_n2jv25', 'notification_email_list': '["pytest_5pf5v3@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T17:14:00.314645', 'lastupdate': '2025-08-28T17:14:00.314645'}, {'entity_type': 1, 'entity_relation_id': 22, 'entity_name': 'pytesté€£æºçµ„ç¹”_dgpxnp', 'notification_email_list': '["pytest_q1picc@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T17:59:21.519591', 'lastupdate': '2025-08-28T17:59:21.519591'}, {'entity_type': 1, 'entity_relation_id': 24, 'entity_name': 'æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_lda84d', 'notification_email_list': '["pytest_agj57k@example.com"]', 'count_reportout_classification': 3, 'analiris_classification_level': 3, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T17:59:21.587711', 'lastupdate': '2025-08-28T17:59:21.603798'}, {'entity_type': 1, 'entity_relation_id': 23, 'entity_name': 'pytesté€£æºçµ„ç¹”_9ikepo', 'notification_email_list': '["pytest_2c8w2d@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T17:59:21.633481', 'lastupdate': '2025-08-28T17:59:21.633481'}, {'entity_type': 1, 'entity_relation_id': 25, 'entity_name': 'pytesté€£æºçµ„ç¹”_ru5lhf', 'notification_email_list': '["pytest_u6vodg@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T18:09:16.083945', 'lastupdate': '2025-08-28T18:09:16.083945'}, {'entity_type': 1, 'entity_relation_id': 27, 'entity_name': 'æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_ekebjv', 'notification_email_list': '["pytest_bsh0jr@example.com"]', 'count_reportout_classification': 3, 'analiris_classification_level': 3, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T18:09:16.153431', 'lastupdate': '2025-08-28T18:09:16.178160'}, {'entity_type': 1, 'entity_relation_id': 26, 'entity_name': 'pytesté€£æºçµ„ç¹”_awhjvh', 'notification_email_list': '["pytest_890w3w@example.com"]', 'count_reportout_classification': 5, 'analiris_classification_level': 2, 'entity_address_postal_code': None, 'entity_address_prefecture': None, 'entity_address_city': None, 'entity_address_line1': None, 'entity_address_line2': None, 'entity_phone_number': None, 'regdate': '2025-08-28T18:09:16.217622', 'lastupdate': '2025-08-28T18:09:16.217622'}]
âœ… é€£æºæƒ…å ±ä¸€è¦§å–å¾—æˆåŠŸ: 25ä»¶
PASSED
tests/test_02_user_entity_links_api.py::test_read_user_entity_links_with_pagination âœ… ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãä¸€è¦§å–å¾—æˆåŠŸ: 5ä»¶
PASSED
tests/test_02_user_entity_links_api.py::test_read_user_entity_link_by_id âœ… é€£æºæƒ…å ±å€‹åˆ¥å–å¾—æˆåŠŸ: entity_type=1, entity_relation_id=30, çµ„ç¹”å=pytesté€£æºçµ„ç¹”_x6zkl5
PASSED
tests/test_02_user_entity_links_api.py::test_read_nonexistent_user_entity_link âœ… å­˜åœ¨ã—ãªã„é€£æºæƒ…å ±ã‚¨ãƒ©ãƒ¼: User entity link not found: entity_type=1, entity_relation_id=99999
PASSED
tests/test_02_user_entity_links_api.py::test_update_user_entity_link âœ… é€£æºæƒ…å ±æ›´æ–°æˆåŠŸ: entity_type=1, entity_relation_id=28, æ–°çµ„ç¹”å=æ›´æ–°æ¸ˆã¿_pytesté€£æºçµ„ç¹”_j6gbzm
PASSED
tests/test_02_user_entity_links_api.py::test_update_with_invalid_data âœ… æ›´æ–°æ™‚ã®ç„¡åŠ¹ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼: çµ„ç¹”ç¨®åˆ¥ï¼ˆentity_type ï¼‰ã¯1ã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼ˆåŒ»ç™‚æ©Ÿé–¢ã‚¿ã‚¤ãƒ—ï¼‰
PASSED
tests/test_02_user_entity_links_api.py::test_update_nonexistent_link âœ… å­˜åœ¨ã—ãªã„é€£æºæƒ…å ±æ›´æ–°ã‚¨ãƒ©ãƒ¼: User entity link not found: entity_type=1, entity_relation_id=99999
PASSED
tests/test_03_user_api.py::test_login_with_temp_password PASSED
tests/test_03_user_api.py::test_update_user PASSED
tests/test_03_user_api.py::test_get_user PASSED
tests/test_03_user_api.py::test_retire_user PASSED
tests/test_03_user_api.py::test_login_suspended_user PASSED
tests/test_04_auth.py::TestAuthManagerUserInfo::test_get_user_info_admin_success PASSED
tests/test_04_auth.py::TestAuthManagerUserInfo::test_get_user_info_medical_success PASSED
tests/test_04_auth.py::TestAuthManagerUserInfo::test_get_user_info_not_found PASSED
tests/test_04_auth.py::TestAuthManagerAdminChecks::test_is_admin_user_id_true PASSED
tests/test_04_auth.py::TestAuthManagerAdminChecks::test_is_admin_user_id_false PASSED
tests/test_04_auth.py::TestAuthManagerAdminChecks::test_is_admin_by_user_info_true PASSED
tests/test_04_auth.py::TestAuthManagerAdminChecks::test_is_admin_by_user_info_false PASSED
tests/test_04_auth.py::TestAuthManagerAdminChecks::test_require_admin_permission_success PASSED
tests/test_04_auth.py::TestAuthManagerAdminChecks::test_require_admin_permission_failure PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_get_user_medical_id_admin PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_get_user_medical_id_medical_user PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_get_user_medical_id_invalid_entity_type PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_check_medical_permission_admin_access PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_check_medical_permission_medical_user_own_facility PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_check_medical_permission_medical_user_other_facility PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_require_medical_permission_success PASSED
tests/test_04_auth.py::TestAuthManagerMedicalPermissions::test_require_medical_permission_failure PASSED
tests/test_04_auth.py::TestAuthManagerAccessibleMedicalIds::test_get_accessible_medical_ids_admin PASSED
tests/test_04_auth.py::TestAuthManagerAccessibleMedicalIds::test_get_accessible_medical_ids_medical_user PASSED
tests/test_04_auth.py::TestAuthManagerAccessibleMedicalIds::test_get_accessible_medical_ids_invalid_user PASSED
tests/test_04_auth.py::TestAuthManagerQueryFiltering::test_filter_by_medical_permission_admin PASSED
tests/test_04_auth.py::TestAuthManagerQueryFiltering::test_filter_by_medical_permission_medical_user PASSED
tests/test_04_auth.py::TestAuthManagerQueryFiltering::test_filter_by_medical_permission_no_access PASSED
tests/test_05_file_management_api.py::test_api_server_is_running âœ… APIã‚µãƒ¼ãƒãƒ¼ç¨¼åƒç¢ºèªå®Œäº†
PASSED
tests/test_05_file_management_api.py::test_file_upload_success ãƒ¬ã‚¹ãƒãƒ³ã‚¹: status_code=200
âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ: medical_id=6, å®Ÿè¡Œæœˆ=2025-08
   ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«æ•°: 3ä»¶
PASSED
tests/test_05_file_management_api.py::test_file_upload_nonexistent_medical_id âœ… å­˜åœ¨ã—ãªã„åŒ»ç™‚æ©Ÿé–¢IDã‚¨ãƒ©ãƒ¼: åŒ»ç™‚æ©Ÿé–¢IDï¼ˆmedical_idï¼‰ 99999 ã¯å­˜åœ¨ã—ã¾ã›ã‚“
PASSED
tests/test_05_file_management_api.py::test_file_upload_wrong_file_extension âœ… ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã‚¨ãƒ©ãƒ¼: åŒ»ç™‚æ©Ÿå™¨å°å¸³ãƒ•ã‚¡ã‚¤ãƒ«ã¯CSVå½¢å¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
PASSED
tests/test_05_file_management_api.py::test_file_upload_missing_file âœ… ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¶³ã‚¨ãƒ©ãƒ¼ç¢ºèªå®Œäº†
PASSED
tests/test_05_file_management_api.py::test_file_upload_overwrite âœ… 1å›ç›®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ: 3ä»¶
âœ… ä¸Šæ›¸ãã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ: 1å›ç›®=2025-08-28T18:25:01, 2å›ç›®=2025-08-28T18:25:01
PASSED
tests/test_05_file_management_api.py::test_upload_status_endpoint âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çŠ¶æ³å–å¾—æˆåŠŸ: 0ä»¶ã®çŠ¶æ³ãƒ‡ãƒ¼ã‚¿
PASSED
tests/test_05_file_management_api.py::test_available_reports_endpoint âœ… åˆ©ç”¨å¯èƒ½ãƒ¬ãƒãƒ¼ãƒˆå–å¾—æˆåŠŸ: 0ä»¶ã®ãƒ¬ãƒãƒ¼ãƒˆ
PASSED
tests/test_05_file_management_api.py::test_system_file_download_success âœ… ãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†
âœ… ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸ: equipment.csv (ãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥=1)
âœ… ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸ: rental.csv (ãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥=2)
âœ… ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸ: failure.csv (ãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥=3)
PASSED
tests/test_05_file_management_api.py::test_system_file_download_unauthorized âœ… èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ: APIã‚­ãƒ¼ãªã—ã§401ã‚¨ ãƒ©ãƒ¼
âœ… èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ: é–“é•ã£ãŸAPIã‚­ãƒ¼ã§401ã‚¨ãƒ©ãƒ¼
PASSED
tests/test_05_file_management_api.py::test_system_file_download_file_not_found âœ… ãƒ•ã‚¡ã‚¤ãƒ«æœªå­˜åœ¨ãƒ†ã‚¹ãƒˆæˆåŠŸ: å­˜åœ¨ã—ãªã„åŒ» ç™‚æ©Ÿé–¢IDã§404ã‚¨ãƒ©ãƒ¼
PASSED
tests/test_05_file_management_api.py::test_system_file_download_invalid_file_type âœ… ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥ãƒ†ã‚¹ãƒˆæˆåŠŸ: ãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥99ã§400ã‚¨ãƒ©ãƒ¼
PASSED
tests/test_05_file_management_api.py::test_publish_reports_unauthorized âœ… ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ: APIã‚­ãƒ¼ãªã— ã§401ã‚¨ãƒ©ãƒ¼
âœ… ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ: é–“é•ã£ãŸAPIã‚­ãƒ¼ã§401ã‚¨ãƒ©ãƒ¼
PASSED
tests/test_05_file_management_api.py::test_publish_reports_with_auth âœ… ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹èªè¨¼æˆåŠŸãƒ†ã‚¹ãƒˆå®Œäº†: èªè¨¼é€šéå¾Œã«404ã‚¨ãƒ©ãƒ¼ï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ãƒ¬ãƒãƒ¼ãƒˆæœªå­˜åœ¨ï¼‰
PASSED
tests/test_05_file_management_api.py::test_publish_onpremise_reports âŒ ã‚¨ãƒ©ãƒ¼è©³ç´°: 404, {"detail":"ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ãƒ¬ãƒãƒ¼ãƒˆ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: åŒ»ç™‚æ©Ÿé–¢ID=5, å¹´æœˆ=2025-05"}
FAILED
tests/test_05_file_management_api.py::test_publish_nonexistent_onpremise_reports âœ… å­˜åœ¨ã—ãªã„åŒ»ç™‚æ©Ÿé–¢IDã§ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹ã‚¨ ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ
PASSED
tests/test_05_file_management_api.py::test_report_download_after_publish âš ï¸ ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹çµæœ: 404 (æ—¢ã«å…¬é–‹æ¸ˆã¿ã®å¯èƒ½æ€§)
ğŸ“‹ å–å¾—ã—ãŸpublication_id: 8
ğŸ“Š ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‰çŠ¶æ…‹: download_user_id=10, download_datetime=2025-08-28 17:14:00.442110
FAILED
tests/test_05_file_management_api.py::test_report_download_nonexistent_publication âœ… å­˜åœ¨ã—ãªã„publication_IDã§ãƒ€ã‚¦ãƒ³ãƒ­ ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ
PASSED
tests/test_05_file_management_api.py::test_report_download_multiple_times FAILED
tests/test_06_equipment_classifications_api.py::test_api_server_is_running âœ… APIã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèªå®Œäº†
PASSED
tests/test_06_equipment_classifications_api.py::test_get_equipment_classifications âœ… æ©Ÿå™¨åˆ†é¡ä¸€è¦§å–å¾—æˆåŠŸ: total=18, å– å¾—ä»¶æ•°=18
   ã‚µãƒ³ãƒ—ãƒ«åˆ†é¡: æ²»ç™‚æ©Ÿå™¨ (level=1)
PASSED
tests/test_06_equipment_classifications_api.py::test_get_equipment_classifications_pagination âœ… ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèªå®Œäº†: 1ãƒšãƒ¼ã‚¸ç›®=5ä»¶, 2ãƒšãƒ¼ã‚¸ç›®=5ä»¶
PASSED
tests/test_06_equipment_classifications_api.py::test_get_equipment_classifications_nonexistent_medical_id âœ… å­˜åœ¨ã—ãªã„åŒ»ç™‚æ©Ÿé–¢IDã§ã®ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ
PASSED
tests/test_06_equipment_classifications_api.py::test_get_report_selection_empty âœ… ãƒ¬ãƒãƒ¼ãƒˆé¸æŠæƒ…å ±å–å¾—æˆåŠŸï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰: max_count=5, é¸æŠæ•°=0
PASSED
tests/test_06_equipment_classifications_api.py::test_create_report_selection âœ… ãƒ¬ãƒãƒ¼ãƒˆé¸æŠæƒ…å ±ç™»éŒ²æˆåŠŸ: ç™»éŒ²æ•°=3
   rank=1: æ²»ç™‚æ©Ÿå™¨ (ID=1501)
   rank=2: ç”Ÿå‘½ç¶­æŒç®¡ç†è£…ç½® (ID=1503)
   rank=3: è¨ºæ–­æ©Ÿå™¨ (ID=1502)
PASSED
tests/test_06_equipment_classifications_api.py::test_get_report_selection_after_create âœ… ãƒ¬ãƒãƒ¼ãƒˆé¸æŠæƒ…å ±å–å¾—æˆåŠŸï¼ˆç™»éŒ² å¾Œï¼‰: é¸æŠæ•°=3
   é¸æŠæƒ…å ±:
     - rank=1: æ²»ç™‚æ©Ÿå™¨ (ID=1501)
     - rank=2: ç”Ÿå‘½ç¶­æŒç®¡ç†è£…ç½® (ID=1503)
     - rank=3: è¨ºæ–­æ©Ÿå™¨ (ID=1502)
PASSED
tests/test_06_equipment_classifications_api.py::test_update_report_selection âœ… ãƒ¬ãƒãƒ¼ãƒˆé¸æŠæƒ…å ±æ›´æ–°æˆåŠŸ: æ›´æ–°æ•°=5
PASSED
tests/test_06_equipment_classifications_api.py::test_create_report_selection_invalid_classification_ids âœ… ç„¡åŠ¹ãªæ©Ÿå™¨åˆ†é¡IDã§ã®ç™»éŒ²ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ
PASSED
tests/test_06_equipment_classifications_api.py::test_create_report_selection_duplicate_ids âœ… é‡è¤‡ã—ãŸæ©Ÿå™¨åˆ†é¡IDã§ã®ç™»éŒ² ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ
PASSED
tests/test_06_equipment_classifications_api.py::test_delete_report_selection âœ… ãƒ¬ãƒãƒ¼ãƒˆé¸æŠæƒ…å ±å‰Šé™¤æˆåŠŸ: å‰Šé™¤æ•°=5
âœ… å‰Šé™¤å¾Œã®ç¢ºèªå®Œäº†: é¸æŠæƒ…å ±ãŒç©ºã«ãªã‚Šã¾ã—ãŸ
PASSED
tests/test_06_equipment_classifications_api.py::test_report_selection_nonexistent_medical_id âœ… å­˜åœ¨ã—ãªã„åŒ»ç™‚æ©Ÿé–¢IDã§ã® ãƒ¬ãƒãƒ¼ãƒˆé¸æŠã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_get_equipment_analysis_settings_basic ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== åŸºæœ¬çš„ãªè¨­å®šä¸€è¦§å–å¾—ãƒ†ã‚¹ãƒˆ ===
âœ… ç·ä»¶æ•°: 1144ä»¶
âœ… æ¬¡ãƒšãƒ¼ã‚¸æœ‰ç„¡: True
âœ… ã‚µãƒ³ãƒ—ãƒ«ã‚¢ã‚¤ãƒ†ãƒ : ledger_id=5666, model='æ‰€ç®¡å¤–æ©Ÿå™¨ï¼ˆè©³ç´°ã¯ãƒ¡ãƒ¢å‚ç…§ï¼‰'
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_get_equipment_analysis_settings_with_pagination ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ ===
âœ… 1ãƒšãƒ¼ã‚¸ç›®: 5ä»¶å–å¾—
âœ… 2ãƒšãƒ¼ã‚¸ç›®: 5ä»¶å–å¾—
âœ… ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ­£å¸¸å‹•ä½œ
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_update_analysis_target_success ã‚¯ ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== åˆ†æå¯¾è±¡ãƒ•ãƒ©ã‚°æ›´æ–°æˆåŠŸãƒ†ã‚¹ãƒˆ ===
âœ… ãƒ†ã‚¹ãƒˆå¯¾è±¡: ledger_id=5666, ç¾åœ¨å€¤=True â†’ æ–°å€¤=False
âœ… æ›´æ–°æˆåŠŸ: åˆ†æå¯¾è±¡ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°ã—ã¾ã—ãŸ
âœ… è¨­å®šåæ˜ ç¢ºèªå®Œäº†
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_update_analysis_target_same_as_default_error ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤åŒä¸€ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ ===
âœ… ãƒ†ã‚¹ãƒˆå¯¾è±¡: ledger_id=5666, ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤=True
âœ… æœŸå¾…é€šã‚Šã®ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆTrueï¼‰ã¨åŒã˜å€¤ã¯è¨­å®šã§ãã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯è¨­å®šã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_update_classification_override_success ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== åˆ†é¡ä¸Šæ›¸ãæ›´æ–°æˆåŠŸãƒ†ã‚¹ãƒˆ ===
SKIPPED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_restore_to_default_single ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== å€‹åˆ¥ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¾©å¸°ãƒ†ã‚¹ãƒˆ ===
âœ… ãƒ†ã‚¹ãƒˆç”¨è¨­å®šä½œæˆå®Œäº†: ledger_id=5666
âœ… å¾©å¸°æˆåŠŸ: æ©Ÿå™¨ID 5666 ã®è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«å¾©å¸°ã—ã¾ã—ãŸ
âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¾©å¸°ç¢ºèªå®Œäº†
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_restore_to_default_all ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ ãƒƒãƒ—å®Œäº†: 200

=== å…¨ä»¶ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¾©å¸°ãƒ†ã‚¹ãƒˆ ===
âœ… ãƒ†ã‚¹ãƒˆç”¨è¨­å®šä½œæˆå®Œäº†: 2ä»¶
âœ… å…¨ä»¶å¾©å¸°æˆåŠŸ: 2ä»¶å‰Šé™¤
   ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: åŒ»ç™‚æ©Ÿé–¢ID 5 ã® 2 ä»¶ã®è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«å¾©å¸°ã—ã¾ã—ãŸ
âœ… å…¨ä»¶ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¾©å¸°ç¢ºèªå®Œäº†
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_invalid_ledger_id_error ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== å­˜åœ¨ã—ãªã„æ©Ÿå™¨IDã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ ===
âœ… æœŸå¾…é€šã‚Šã®ã‚¨ãƒ©ãƒ¼: æŒ‡å®šã•ã‚ŒãŸæ©Ÿå™¨ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
PASSED
tests/test_07_medical_equipment_analysis_api.py::TestMedicalEquipmentAnalysisAPI::test_invalid_classification_id_error ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†: 200

=== å­˜åœ¨ã—ãªã„åˆ†é¡IDã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ ===
âœ… æœŸå¾…é€šã‚Šã®ã‚¨ãƒ©ãƒ¼: æŒ‡å®šã•ã‚ŒãŸåˆ†é¡IDãŒå­˜åœ¨ã—ã¾ã›ã‚“
PASSED

======================================================= FAILURES ========================================================
_____________________________________________ test_create_user_entity_link ______________________________________________

    def test_create_user_entity_link():
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ„ç¹”é€£æºæƒ…å ±æ–°è¦ç™»éŒ²ãƒ†ã‚¹ãƒˆ"""
        entity_name = random_entity_name()
        payload = {
            "entity_type": 1,
            "entity_relation_id": 6,  # ãƒ†ã‚¹ãƒˆç”¨åŒ»ç™‚æ©Ÿé–¢IDï¼ˆä¾‹: 6ï¼‰
            "entity_name": entity_name,
            "notification_email_list": random_email_list(),
            "count_reportout_classification": 5,
            "analiris_classification_level": 1  # å¤§åˆ†é¡
        }
        res = requests.post(f"{BASE_URL}/user-entity-links/", json=payload, headers=TEST_HEADERS)
>       assert res.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500]>.status_code

tests/test_02_user_entity_links_api.py:201: AssertionError
____________________________________________ test_publish_onpremise_reports _____________________________________________

    def test_publish_onpremise_reports():
        """ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹ãƒ†ã‚¹ãƒˆï¼ˆhpcode=5ã€2025-05æœˆåˆ†ï¼‰"""
        medical_id = 5
        publication_ym = "2025-05"
        system_key = "optiserve-internal-system-key-2025"

        data = {
            'publication_ym': publication_ym
        }
        headers = {"X-System-Key": system_key}

        publish_res = requests.post(
            f"{BASE_URL}/files/reports/publish/{medical_id}",
            data=data,
            headers=headers
        )

        if publish_res.status_code != 200:
            print(f"âŒ ã‚¨ãƒ©ãƒ¼è©³ç´°: {publish_res.status_code}, {publish_res.text}")
>       assert publish_res.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404]>.status_code

tests/test_05_file_management_api.py:552: AssertionError
__________________________________________ test_report_download_after_publish ___________________________________________

    def test_report_download_after_publish():
        """ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹å¾Œã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆï¼ˆuser_id=10ï¼‰"""
        medical_id = 5
        publication_ym = "2025-05"
        system_key = "optiserve-internal-system-key-2025"
        download_user_id = "10"

        # Step 1: ãƒ¬ãƒãƒ¼ãƒˆã‚’å…¬é–‹ï¼ˆã¾ãšå…¬é–‹ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã®publication_idã‚’å–å¾—ï¼‰
        data = {
            'publication_ym': publication_ym
        }
        headers = {"X-System-Key": system_key}

        publish_res = requests.post(
            f"{BASE_URL}/files/reports/publish/{medical_id}",
            data=data,
            headers=headers
        )

        if publish_res.status_code != 200:
            # æ—¢ã«å…¬é–‹æ¸ˆã¿ã®å ´åˆã¯å•é¡Œãªã—
            print(f"âš ï¸ ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹çµæœ: {publish_res.status_code} (æ—¢ã«å…¬é–‹æ¸ˆã¿ã®å¯èƒ½æ€§)")
        else:
            publish_data = publish_res.json()
            print(f"âœ… ãƒ¬ãƒãƒ¼ãƒˆå…¬é–‹æˆåŠŸ: {len(publish_data['published_reports'])}ä»¶")

        # Step 2: DBã‹ã‚‰æœ€æ–°ã®publication_idã‚’å–å¾—ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
        from src.database import SessionLocal
        from src.models.pg_optigate.report_publication_log import ReportPublicationLog

        db = SessionLocal()
        try:
            # å¯¾è±¡åŒ»ç™‚æ©Ÿé–¢ãƒ»å¹´æœˆã®æœ€æ–°ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—
            latest_report = db.query(ReportPublicationLog).filter(
                ReportPublicationLog.medical_id == medical_id,
                ReportPublicationLog.publication_ym == publication_ym
            ).order_by(ReportPublicationLog.upload_datetime.desc()).first()

            if not latest_report:
                raise Exception(f"å…¬é–‹ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: åŒ»ç™‚æ©Ÿé–¢ID={medical_id}, å¹´æœˆ={publication_ym}")

            publication_id = latest_report.publication_id
            print(f"ğŸ“‹ å–å¾—ã—ãŸpublication_id: {publication_id}")

            # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‰ã®DBçŠ¶æ…‹ã‚’è¨˜éŒ²
            download_datetime_before = latest_report.download_datetime
            download_user_id_before = latest_report.download_user_id
            print(f"ğŸ“Š ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‰çŠ¶æ…‹: download_user_id={download_user_id_before}, download_datetime={download_datetime_before}")

        finally:
            db.close()

        # Step 3: ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
        download_res = requests.get(
            f"{BASE_URL}/files/reports/download/{publication_id}",
            params={"user_id": download_user_id},
            headers=TEST_HEADERS
        )

>       assert download_res.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404]>.status_code

tests/test_05_file_management_api.py:662: AssertionError
__________________________________________ test_report_download_multiple_times __________________________________________

    def test_report_download_multiple_times():
        """åŒä¸€ãƒ¬ãƒãƒ¼ãƒˆã®è¤‡æ•°å›ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆï¼ˆDBæ›´æ–°ã¯åˆå›ã®ã¿ï¼‰"""
        medical_id = 5
        publication_ym = "2025-05"
        user_id_1 = "10"
        user_id_2 = "1"  # ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼

        # æœ€æ–°ãƒ¬ãƒãƒ¼ãƒˆã®publication_idã‚’å–å¾—
        from src.database import SessionLocal
        from src.models.pg_optigate.report_publication_log import ReportPublicationLog

        db = SessionLocal()
        try:
            latest_report = db.query(ReportPublicationLog).filter(
                ReportPublicationLog.medical_id == medical_id,
                ReportPublicationLog.publication_ym == publication_ym
            ).order_by(ReportPublicationLog.upload_datetime.desc()).first()

            if not latest_report:
                print("âš ï¸ ãƒ†ã‚¹ãƒˆç”¨ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«test_report_download_after_publishã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„")
                return

            publication_id = latest_report.publication_id

            # 1å›ç›®ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆæ—¢ã«å®Ÿè¡Œæ¸ˆã¿ã®æƒ³å®šï¼‰
            first_download_user_id = latest_report.download_user_id
            first_download_datetime = latest_report.download_datetime

        finally:
            db.close()

        # 2å›ç›®ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆåˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
        download_res = requests.get(
            f"{BASE_URL}/files/reports/download/{publication_id}",
            params={"user_id": user_id_2},
            headers=TEST_HEADERS
        )

>       assert download_res.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404]>.status_code

tests/test_05_file_management_api.py:743: AssertionError
================================================ short test summary info ================================================
FAILED tests/test_02_user_entity_links_api.py::test_create_user_entity_link - assert 500 == 200
FAILED tests/test_05_file_management_api.py::test_publish_onpremise_reports - assert 404 == 200
FAILED tests/test_05_file_management_api.py::test_report_download_after_publish - assert 404 == 200
FAILED tests/test_05_file_management_api.py::test_report_download_multiple_times - assert 404 == 200
======================================== 4 failed, 84 passed, 1 skipped in 3.67s ========================================
((.venv) ) smds@aoi-ph-017:~/projects/optiserve-backend$
